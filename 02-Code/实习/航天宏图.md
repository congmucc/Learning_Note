1、对加密软件的使用。
2、对项目进行备份更新回滚输出日志等操作

- 备份标准
  - 文件修改：使用`mv`命令将文件名字设置为`.bak`形式。 例如：`mv xjar.go xjar.go.bak`
  - 内容修改：将文件命令先注释，之后进行修改。
- 回滚标准是使用`cp`命令将文件名字后面的`.bak`删除即可 例如：`cp xjar.go.bak xjar.go`
- 使用 `前者 > 后者` 命令生成一个日志。

3、线程池的使用
4、Hibernate
5、postgresql

# 2024/5/15
## 替换镜像提交到harbor

1. 对镜像进行加载

   ```docker
   docker load -i security-auth-service.tar.gz
   ```

   结果如下：

   `Loaded image: server/security-auth-service:v1`

   > 镜像名字是后面的 `server/security-auth-service:v1`

2. 对镜像名字进行修改
   ```docker
   docker tag server/security-auth-service:v1 172.16.154.212:1180/server/security-auth-service:v1
   ```

   > 这里的`172.16.154.212:1180`是通过使用命令`docker images`来进行查看的，在镜像的开头就是服务器

3. 对镜像进行上传
   ```docker
   docker push 172.16.154.212:1180/server/security-auth-service:v1
   ```

4. k8s删除原有的pod

   ```k8s
   kubectl delete pods security-auth-service-84b7c7bb4c-bx664 -n pie-engine-server
   ```

   > 这个删除完之后会自动创建新的pod,进行重启

5. 查看所有pod获取新的pod名称 
   ```k8s
   kubectl get pods [-A / -n pie-engine-server]
   ```

   > 这个获取新的pod名称可以通过时间来进行获取
   >
   > 通过这个命令查看新启动的pod是否正常。

6. 通过新的pod名称来进行查看日志或者

   ```k8s
   kubectl logs 重启后的pod名称 -n pie-engine-server
   ```

   > - 这个命令用于查看一个或多个容器的stdout 和 stderr 输出，即容器的标准输出和标准错误流。
   > - 当你想要检查应用程序的日志，以诊断问题或理解应用程序的行为时，通常会使用这个命令

   ```k8s
   kubectl describe pods 重启后的pod名称 -n pie-engine-server
   ```

   > - 这个命令提供了一个详细的视图，包括 pod 的配置、状态、事件、IP 地址、节点信息、容器镜像以及其他相关元数据。
   > - 它不仅显示 pod 内每个容器的日志摘要（如果有），还显示了 pod 的完整生命周期信息，比如创建时间、启动和停止事件、重启策略等





## 修改了yaml文件之后需要操作 && 重启服务

> 如果重启一个服务直接delete和apply即可。

1. 进行提交

   ```k8s
   kubectl delete -f security-auth-server.yaml
   ```

   > 可以先删除再提交，也可以直接提交

   ```k8s
   kubectl apply -f security-auth-server.yaml
   ```

2. 获取相应的pods
   ```k8s
   kubectl get pods -n pie-engine-server
   ```

   详细查看pods

   ```k8s
   kubectl describe pods security-auth-service-84dbd6b75-gwx7g -n pie-engine-server
   ```

   查看logs

   ```k8s
   kubectl logs security-auth-service-84dbd6b75-gwx7g -n pie-engine-server
   ```






## 对`no space left on device`的处理

场景：

```docker
[root@master home]# docker load -i security-auth-service.tar.gz
mkdir /data/docker/tmp/docker-import-597606404: no space left on device

[root@master home]# docker rmi -f server/security-auth-service
Error: No such image: server/security-auth-service

[root@master home]# docker rmi -f server/security-auth-service:v1
Error response from daemon: open /data/docker/image/overlay2/.tmp-repositories.json745161134: no space left on device
```

> 出现错误`no space left on device`
>
> 这是因为iNode满了，iNode相当于索引，存储文件的源信息，具体原因一般都是小文件太多导致的，服务器上原因是因为进行了切片导致了小文件太多了，将索引占完了。
>
> 附加：
>
> 这个因为有个定时任务，所以说需要将定时任务先删除。

解决方案： 

使用`df -i`查看一下相应的利用率，看谁的高，然后利用命令

```shell
for i in /data/sharefile/objects/*; do echo $i; find $i | wc -l; done
```

> 这里需要明白的是`in`后面的是自己需要查看的目录

打印目录下文件数目，一层一层向下走，直到找到相应的切片目录，如果可以删除就删了。

## 使用nfs进行局域网内两台服务器文件共享

是再`212服务器`上面的`/home/share`文件夹共享到`213服务器`上的`/data/imagedata/share`

```shell
-- 212 
rpm -qa nfs-utils rpcbind

systemctl status nfs

mkdir -p /home/share chmod 777 /home/share

vim /etc/exports
// 需要输入下面的数据
/home/share 172.16.154.213(rw,sync,insecure,no_subtree_check,no_root_squash)

保存后 systemctl start rpcbind

systemctl start nfs

systemctl status nfs

cat   /etc/exports

ln -s /home/share /data/sharefile/share




-- 213

mkdir /data/imagedata/share

mount 172.16.154.212:/home/share  /data/imagedata/share

ll /data/imagedata/share

```



# 2024/5/16





## 重启所有服务

```shell
cd /home/server/scripts
sh restart_app.sh
cd /home/server/scripts/help
sh 1_restart_bpaas_server.sh
如果scripts下没有help则手动执行下面两个命令
v3.4.5之后下面的脚本都不需要执行了。
重启完所有服务之后因为中间件顺序问题
需要做：
\#重启bpaas
kubectl get pod -n pie-engine-bpaas | awk '{print $1}' | xargs kubectl delete pod -n pie-engine-bpaas
\#重启server，后于bpaas几秒启动，因为注册，确定bpaas重启完执行下面
kubectl get pod -n pie-engine-server | awk '{print $1}' | xargs kubectl delete pod -n pie-engine-server
```







## job查看

```shell
kjob get pod|grep Running 
```

> 查询正在运行的job





## 重启harbor



```shell
#harbor目录一般在这儿 根据global.yaml来的
cd /home/server/depends/harbor
#查状态
docker-compose ps
#停harbor
docker-compose down
#启动harbor
docker-compose up -d
#验证
登录http://ip:1180
能访问到登录页面即可

或者看下能否登陆成功
执行这个 restart_harbor.sh
docker login 你的ip:1180
账号 admin

看下能否登陆成功

-----------------------------------------------------------------------
#查harbor日志
/var/log/harbor
tail -f postgresql.log
#harbor数据目录 根据global.yaml来的
cd /data/harbor/database
chmod 750 pg13
```



# 2024/5/20

## 锁

# 2024/5/21

## 线程池

线程池的使用场景：

1、异步使用。

2、进行推送，如百万级数据推送。

[【博客】线程池的使用_阅读数_bilibili](https://www.bilibili.com/video/BV1bh411a7SE/?p=2)

[线程在实际项目中的应用场景，可用于面试，十年大厂程序员讲解，通俗易懂](https://www.bilibili.com/video/BV16g41177Pw/?share_source=copy_web&vd_source=a9e0245042931de24eb0a8f018fa0eae)



# 2024/5/23

## 测试接口在服务器上通没通

>  可以直接在linux服务器上面用 telnet IP 端口 命令看看端口通不通，或者用curl命令看看url地址能不能访问

```shell
curl -X POST http://192.168.1.1:8083/kfpt/openapi/getApiToken
```



```shell
curl http://192.168.1.1/OneMapServer/rest/services/sat_2013/MapServer
```



```shell
ping 192.168.1.1
```



```shell
telnet 192.168.1.1 80
```





# 2024/5/28

## 文档能力

着重注意文档，文档能力必须要整理好，不然到之后还得麻烦自己。



# 2024/5/31

## mysql的多表联合查询

```sql
INSERT INTO production_entity (
    zt_code,
    zt_type,
    name,
    latitude,
    longitude,
    area,
    create_time,
    update_time,
    region_name,
    region_code
)
WITH subquery AS (
    SELECT
        t.zt_code,
        t.zt_type,
        t.zt_name,
        t.farm_center_lat,
        t.farm_center_lng,
        COALESCE(SUM(area), 0) AS total_area
    FROM
        rice_planter_info t
    GROUP BY
        t.zt_code,
        t.zt_type,
        t.zt_name,
        t.farm_center_lat,
        t.farm_center_lng
)
SELECT
    subquery.zt_code,
    subquery.zt_type,
    subquery.zt_name,
    subquery.farm_center_lat,
    subquery.farm_center_lng,
    subquery.total_area,
    NOW() AS create_time,
    NOW() AS update_time,
    rp.county_name,
    sr.region_code
FROM
    subquery
JOIN rice_plant_info rp ON subquery.zt_code = rp.zt_code
JOIN sys_region sr ON sr.region_name = rp.county_name;
-- 这里会有重复数据，来源于JOIN rice_plant_info rp ON subquery.zt_code = rp.zt_code
```

优化为：

```sql
```

